<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ATOMX D PROJECT</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --primary: #4f46e5; --bg-color: #f8fafc; --card-bg: #ffffff; --text-main: #334155; --text-light: #94a3b8; --sidebar-bg: #0f172a; --danger: #ef4444; --success: #10b981; --warning: #f59e0b; --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        [data-theme="dark"] { --primary: #6366f1; --bg-color: #111827; --card-bg: #1f2937; --text-main: #f1f5f9; --text-light: #9ca3af; --sidebar-bg: #000000; --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5); }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg-color); color: var(--text-main); margin: 0; overflow-x: hidden; transition: 0.3s; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        /* PRIVACY BLUR */
        body.privacy-active .privacy-sensitive { filter: blur(6px); user-select: none; }

        /* LOGIN PAGE */
        #loginPage { position: fixed; inset: 0; background: var(--bg-color); z-index: 5000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .login-card { background: var(--card-bg); padding: 30px; border-radius: 20px; width: 100%; max-width: 350px; box-shadow: var(--shadow); text-align: center; }
        .login-input { width: 100%; padding: 14px; margin-bottom: 15px; border: 1px solid #e2e8f0; border-radius: 12px; background: var(--bg-color); color: var(--text-main); outline:none; }
        .btn-login { width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; }

        /* LOADING */
        #loadingScreen { position: fixed; inset: 0; background: var(--bg-color); z-index: 4000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .spinner { width: 50px; height: 50px; border: 5px solid #e2e8f0; border-top: 5px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* MAIN APP */
        #mainApp { display: none; }
        header { background: var(--card-bg); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
        .app-title { font-weight: 800; font-size: 1.1rem; color: var(--primary); letter-spacing: 1px; }
        .status-indicator { font-size: 1rem; transition: color 0.3s; }
        .status-online { color: var(--success); } .status-offline { color: var(--danger); }

        /* SIDEBAR */
        .sidebar { position: fixed; left: -280px; top: 0; width: 280px; height: 100%; background: var(--sidebar-bg); color: #f3f4f6; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 1000; display: flex; flex-direction: column; box-shadow: 5px 0 15px rgba(0,0,0,0.3); }
        .sidebar.active { left: 0; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; z-index: 999; backdrop-filter: blur(2px); }
        .overlay.active { display: block; }
        
        .menu-item { padding: 15px 25px; display: flex; align-items: center; gap: 15px; cursor: pointer; color: #cbd5e1; transition: 0.2s; border-left: 4px solid transparent; }
        .menu-item.active { background: rgba(255,255,255,0.05); border-left-color: var(--primary); color: white; }
        .toggle-switch { position: relative; width: 40px; height: 20px; background: #334155; border-radius: 20px; transition: 0.3s; margin-left: auto; }
        .toggle-switch::after { content: ''; position: absolute; top: 2px; left: 2px; width: 16px; height: 16px; background: white; border-radius: 50%; transition: 0.3s; }
        .toggle-active { background: var(--success); } .toggle-active::after { left: 22px; }

        /* CONTAINER */
        .container { padding: 20px; max-width: 800px; margin: auto; padding-bottom: 50px; }
        .page { display: none; animation: fadeIn 0.4s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* DASHBOARD */
        .dashboard-card { background: linear-gradient(135deg, var(--primary), #8b5cf6); color: white; padding: 30px 20px; border-radius: 20px; text-align: center; box-shadow: 0 10px 20px -5px rgba(79, 70, 229, 0.4); margin-bottom: 20px; }
        .clock { font-size: 2.8rem; font-weight: 800; }
        .user-status-card { background: var(--card-bg); padding: 15px; border-radius: 15px; margin-bottom: 20px; display: flex; align-items: center; gap: 15px; box-shadow: var(--shadow); border-left: 5px solid var(--success); }

        /* FORMS */
        .form-group { margin-bottom: 15px; position: relative; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-light); }
        input { width: 100%; padding: 12px; border: 1px solid var(--text-light); border-radius: 10px; background: var(--card-bg); color: var(--text-main); outline: none; }
        .chips { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 5px; }
        .chip { padding: 8px 16px; border: 1px solid var(--text-light); border-radius: 20px; cursor: pointer; }
        .chip.active { background: var(--primary); color: white; border-color: var(--primary); }
        .btn-save { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: bold; margin-top: 10px; }

        /* LIST & LOGS */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        .card { background: var(--card-bg); padding: 20px; border-radius: 16px; box-shadow: var(--shadow); cursor: pointer; display: flex; gap: 15px; }
        .user-icon { width: 50px; height: 50px; border-radius: 50%; background: #e0e7ff; color: var(--primary); display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
        .card-info { flex-grow: 1; }
        .card-title { font-weight: bold; font-size: 1.1rem; }
        .card-time { font-size: 0.75rem; color: var(--text-light); margin-top: 8px; border-top: 1px dashed #e2e8f0; padding-top: 5px; }
        
        .log-item { background: var(--card-bg); padding: 12px; border-radius: 10px; font-size: 0.9rem; display: flex; justify-content: space-between; align-items: center; border-left: 3px solid var(--text-light); margin-bottom: 10px; }
        .log-item.login { border-left-color: var(--success); } .log-item.create { border-left-color: var(--primary); } .log-item.edit { border-left-color: var(--warning); }

        /* MODAL */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal-overlay.active { display: flex; }
        .modal-content { background: var(--card-bg); width: 90%; max-width: 380px; border-radius: 24px; overflow: hidden; }
        .modal-header { padding: 30px; text-align: center; color: white; }
        .modal-profile-img { width: 80px; height: 80px; border-radius: 50%; background: white; color: #333; display: flex; align-items: center; justify-content: center; font-size: 35px; margin: -40px auto 10px auto; border: 4px solid var(--card-bg); }
        .modal-body { padding: 10px 25px 25px 25px; }
        .modal-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px dashed var(--text-light); }
        .modal-val { font-weight: bold; color: var(--text-main); cursor: pointer; }
        
        .bg-kpay { background: #0056b3; } .bg-wave { background: #fbbf24; color: #333 !important; } .bg-uab { background: #000; } .bg-yoma { background: #dc2626; } .bg-cb { background: linear-gradient(135deg, #000080, #dc2626); } .bg-other { background: var(--primary); }

        /* TOAST */
        .toast { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); background: white; color: #333; padding: 15px 25px; border-radius: 30px; box-shadow: 0 15px 30px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 12px; z-index: 6000; transition: 0.4s; font-weight: 600; border-left: 5px solid var(--success); }
        .toast.show { top: 30px; } .toast.error { border-left-color: var(--danger); }
    </style>
</head>
<body>

    <div id="loginPage">
        <div class="login-card">
            <h2 style="color:var(--primary); margin-top:0;">ATOMX D LOGIN</h2>
            <input type="text" id="loginUser" class="login-input" placeholder="User Name">
            <div style="position:relative; margin-bottom:15px;">
                <input type="password" id="loginPass" class="login-input" placeholder="Password" style="margin-bottom:0;">
                <i class="fas fa-eye" style="position:absolute; right:15px; top:50%; transform:translateY(-50%); color:#94a3b8; cursor:pointer;" onclick="togglePass()"></i>
            </div>
            <button class="btn-login" onclick="handleLogin()">Log In</button>
        </div>
    </div>

    <div id="loadingScreen">
        <div class="spinner"></div>
        <p style="color:var(--text-light); margin-top:15px;">Syncing with Cloud...</p>
    </div>

    <div class="toast" id="toast"><i id="toastIcon" class="fas fa-check-circle"></i><span id="toastMsg">Success</span></div>

    <div id="mainApp">
        <header>
            <i class="fas fa-bars" style="font-size:22px; cursor:pointer;" onclick="toggleSidebar()"></i>
            <span class="app-title">ATOMX D PROJECT</span>
            <div style="display:flex; gap:15px; align-items:center;">
                <i class="fas fa-wifi status-indicator" id="wifiIcon"></i>
                <i class="fas fa-eye" style="font-size:20px; cursor:pointer;" onclick="togglePrivacy()"></i>
            </div>
        </header>

        <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

        <div class="sidebar" id="sidebar">
            <div style="padding:25px 20px; display:flex; justify-content:space-between; align-items:center;">
                <h3>Menu</h3><i class="fas fa-times" onclick="toggleSidebar()"></i>
            </div>
            <div style="flex-grow:1; overflow-y:auto;">
                <div class="menu-item active" onclick="navTo('dashboardPage', this)"><i class="fas fa-home"></i> Dashboard</div>
                <div class="menu-item" onclick="navTo('createPage', this)"><i class="fas fa-plus-circle"></i> Create Account</div>
                <div class="menu-item" onclick="navTo('listPage', this)"><i class="fas fa-list-ul"></i> Account List</div>
                <div class="menu-item" onclick="navTo('logPage', this)"><i class="fas fa-history"></i> Activity Log</div>
                <div style="height:1px; background:#334155; margin:10px 20px;"></div>
                <div class="menu-item" onclick="toggleTheme()"><i class="fas fa-adjust"></i> Dark/Light Mode</div>
                <div class="menu-item" onclick="toggleHaptic()">
                    <i class="fas fa-mobile-alt"></i> Haptic
                    <div id="hapticSwitch" class="toggle-switch"></div>
                </div>
            </div>
            <div style="padding:20px; color:var(--danger); cursor:pointer; font-weight:bold; display:flex; align-items:center; gap:10px;" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Log Out
            </div>
        </div>

        <div class="container">
            <div id="dashboardPage" class="page active">
                <div class="dashboard-card">
                    <div class="clock" id="clock">00:00</div>
                    <div class="date" id="date">Mon, 1 Jan</div>
                </div>
                <div class="user-status-card privacy-sensitive">
                    <div style="width:40px; height:40px; background:#e0e7ff; color:var(--primary); border-radius:50%; display:flex; align-items:center; justify-content:center;"><i class="fas fa-user-check"></i></div>
                    <div>
                        <div style="font-weight:bold; font-size:1.1rem;" id="dashUser">Guest</div>
                        <div style="font-size:0.85rem; color:var(--text-light);">Online • <span id="dashTime">-</span></div>
                    </div>
                </div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                    <div style="background:var(--card-bg); padding:20px; border-radius:15px; text-align:center; box-shadow:var(--shadow);">
                        <div class="privacy-sensitive" style="font-size:2rem; font-weight:bold; color:var(--primary);" id="totalCount">0</div>
                        <div style="color:var(--text-light); font-size:0.9rem;">Total Accounts</div>
                    </div>
                    <div style="background:var(--card-bg); padding:20px; border-radius:15px; text-align:center; box-shadow:var(--shadow);">
                        <div class="privacy-sensitive" style="font-size:2rem; font-weight:bold; color:var(--success);" id="todayCount">0</div>
                        <div style="color:var(--text-light); font-size:0.9rem;">Created Today</div>
                    </div>
                </div>
            </div>

            <div id="createPage" class="page">
                <h2 id="formTitle">Create Account</h2>
                <input type="hidden" id="editId">
                <div class="form-group"><label>Name</label><input type="text" id="name"></div>
                <div class="form-group"><label>Bank Number</label><input type="tel" id="bankNum"></div>
                <div class="form-group"><label>NRC</label><input type="text" id="nrc"></div>
                <div class="form-group"><label>PIN</label><input type="password" id="pin"><i class="fas fa-eye" style="position:absolute; right:15px; top:40px; color:#94a3b8;" onclick="toggleFormPin()"></i></div>
                <div class="form-group"><label>Auto No.</label><input type="text" id="autoNo"></div>
                <div class="form-group"><label>Platform</label>
                    <div class="chips">
                        <span class="chip" onclick="setPlatform(this, 'KBZPay')">KBZPay</span>
                        <span class="chip" onclick="setPlatform(this, 'Wave Money')">Wave Money</span>
                        <span class="chip" onclick="setPlatform(this, 'CB Pay')">CB Pay</span>
                        <span class="chip" onclick="setPlatform(this, 'UAB Pay')">UAB Pay</span>
                        <span class="chip" onclick="setPlatform(this, 'Yoma Bank')">Yoma Bank</span>
                        <span class="chip" onclick="setPlatform(this, 'Other')">Other</span>
                    </div>
                    <input type="hidden" id="platform">
                </div>
                <button class="btn-save" id="saveBtn" onclick="saveData()">Create Account</button>
                <button class="btn-save" style="background:var(--text-light); display:none;" id="cancelBtn" onclick="resetForm()">Cancel</button>
            </div>

            <div id="listPage" class="page">
                <h2 style="margin-bottom:20px;">Account List</h2>
                <div class="form-group" style="position:relative;"><i class="fas fa-search" style="position:absolute; left:15px; top:12px; color:var(--text-light);"></i><input type="text" id="searchBox" style="padding-left:40px;" onkeyup="renderList()"></div>
                <div id="gridContainer" class="grid"></div>
            </div>

            <div id="logPage" class="page">
                <h2 style="margin-bottom:20px;">Activity Log</h2>
                <div id="logContainer" style="display:flex; flex-direction:column; gap:10px;"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="detailModal">
        <div class="modal-content">
            <div id="modalHeaderBg" class="modal-header">
                <h3 id="modalName" class="privacy-sensitive" style="margin:0;">Name</h3>
                <span id="modalPlatform" style="opacity:0.8;">Platform</span>
            </div>
            <div class="modal-profile-img" id="modalProfile"><i class="fas fa-user"></i></div>
            <div class="modal-body">
                <div class="modal-row"><span style="color:var(--text-light);">Number</span><span class="modal-val privacy-sensitive" id="modalNum" onclick="copyText(this.innerText)">-</span></div>
                <div class="modal-row"><span style="color:var(--text-light);">NRC</span><span class="modal-val privacy-sensitive" id="modalNrc" onclick="copyText(this.innerText)">-</span></div>
                <div class="modal-row"><span style="color:var(--text-light);">PIN</span><span class="modal-val privacy-sensitive" id="modalPin" onclick="copyText(this.innerText)">-</span></div>
                <div class="modal-row" style="border:none;"><span style="color:var(--text-light);">Auto No.</span><span class="modal-val privacy-sensitive" id="modalAuto" onclick="copyText(this.innerText)">-</span></div>
                <p style="text-align:center; font-size:0.8rem; color:var(--text-light);">(Tap values to copy)</p>
                <div style="display:flex; gap:10px;">
                    <button class="btn-save" style="background:var(--text-light); margin:0;" onclick="closeModal()">Close</button>
                    <button class="btn-save" style="margin:0;" onclick="editAccount()">Edit</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, updateDoc, onSnapshot, query, orderBy, serverTimestamp, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // *** မိတ်ဆွေ၏ FIREBASE CONFIG အစစ် ***
        const firebaseConfig = {
            apiKey: "AIzaSyBCBimkrfs-TGM-TioINkZfmQiBvIBsp1s",
            authDomain: "atomx-d-project.firebaseapp.com",
            projectId: "atomx-d-project",
            storageBucket: "atomx-d-project.firebasestorage.app",
            messagingSenderId: "597963995568",
            appId: "1:597963995568:web:71799d889ea0cf48ebfe75",
            measurementId: "G-Q8RJF1DPYW"
        };

        // --- FIREBASE SETUP ---
        let db, accountsRef, logsRef;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            accountsRef = collection(db, "accounts");
            logsRef = collection(db, "logs");
            console.log("Connected to Firebase!");
        } catch (e) {
            console.error("Firebase Init Error:", e);
            alert("Connection Error! Please check your internet.");
        }

        // --- GLOBAL VARS ---
        let localAccounts = []; 
        let localLogs = [];
        let currentUser = null;
        let hapticEnabled = localStorage.getItem('haptic') !== 'false'; 
        
        function triggerHaptic(pattern = 30) {
            if(hapticEnabled && navigator.vibrate) navigator.vibrate(pattern);
        }

        // --- 1. LOGIN ---
        const VALID_USERS = { "Ei Ko Zin": "78521896", "Raycod": "78521896", "Htoo San": "78521896" };
        
        window.handleLogin = async function() {
            const u = document.getElementById('loginUser').value.trim();
            const p = document.getElementById('loginPass').value.trim();
            if (VALID_USERS[u] && VALID_USERS[u] === p) {
                currentUser = u;
                document.getElementById('dashUser').innerText = u;
                document.getElementById('dashTime').innerText = new Date().toLocaleTimeString();
                
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('loadingScreen').style.display = 'flex';
                
                await logAction('Login', `User ${u} Logged In`, 'login');
                startListeners(); // Start syncing
            } else {
                showToast('Invalid Login!', 'error');
                triggerHaptic([50, 50, 50]);
            }
        };

        window.togglePass = function() {
            const p = document.getElementById('loginPass');
            p.type = p.type === 'password' ? 'text' : 'password';
        }

        // --- 2. FIREBASE SYNC ---
        function startListeners() {
            // Sync Accounts
            const q = query(accountsRef, orderBy("createdAt", "desc"));
            onSnapshot(q, (snapshot) => {
                localAccounts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                updateStats();
                if(document.getElementById('listPage').style.display === 'block') renderList();
            });

            // Sync Logs
            const logQ = query(logsRef, orderBy("time", "desc"));
            onSnapshot(logQ, (snapshot) => {
                localLogs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                if(document.getElementById('logPage').style.display === 'block') renderLogs();
            });
        }

        // --- 3. CRUD ---
        window.saveData = async function() {
            const id = document.getElementById('editId').value;
            const bankNum = document.getElementById('bankNum').value;
            
            // Duplicate Check
            if(localAccounts.some(acc => acc.bankNum === bankNum && acc.id !== id)) {
                showToast("Number Exists!", 'error'); triggerHaptic(100); return;
            }

            const data = {
                name: document.getElementById('name').value,
                bankNum: bankNum,
                nrc: document.getElementById('nrc').value,
                pin: document.getElementById('pin').value,
                autoNo: document.getElementById('autoNo').value,
                platform: document.getElementById('platform').value,
                updatedAt: new Date().toLocaleString(),
                updatedBy: currentUser
            };

            if(!data.name || !data.bankNum || !data.platform) { showToast("Missing Info!", 'error'); triggerHaptic(100); return; }

            try {
                if(id) {
                    await updateDoc(doc(db, "accounts", id), data);
                    await logAction('Edit', `Updated ${data.name} (${data.platform})`, 'edit');
                    showToast("Updated!", 'success');
                } else {
                    data.createdAt = new Date().toLocaleString();
                    data.createdBy = currentUser;
                    await addDoc(accountsRef, data);
                    await logAction('Create', `Created ${data.name} (${data.platform})`, 'create');
                    showToast("Created!", 'success');
                }
                resetForm();
                triggerHaptic(50);
            } catch (e) {
                console.error(e);
                showToast("Save Error!", 'error');
            }
        };

        window.renderList = function() {
            const grid = document.getElementById('gridContainer');
            grid.innerHTML = '';
            const q = document.getElementById('searchBox').value.toLowerCase();
            
            localAccounts.filter(i => i.name.toLowerCase().includes(q) || i.bankNum.includes(q)).forEach(item => {
                const div = document.createElement('div');
                div.className = 'card';
                div.onclick = () => openModal(item);
                div.innerHTML = `
                    <div class="user-icon"><i class="fas fa-user"></i></div>
                    <div class="card-info">
                        <div class="card-title privacy-sensitive">${item.name}</div>
                        <div class="card-sub">${item.platform}</div>
                        <div class="card-sub privacy-sensitive">${item.bankNum}</div>
                        <div class="card-time">Created: ${item.createdAt?.split(',')[0] || '-'}</div>
                    </div>
                `;
                grid.appendChild(div);
            });
        };

        async function logAction(action, desc, type) {
            if(!db) return;
            const ua = navigator.userAgent;
            let device = "Desktop";
            if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua)) device = "Mobile";

            await addDoc(logsRef, {
                action, desc, type, user: currentUser, device: device,
                time: serverTimestamp()
            });
        }

        window.renderLogs = function() {
            const container = document.getElementById('logContainer');
            container.innerHTML = '';
            localLogs.forEach(log => {
                const date = log.time ? new Date(log.time.seconds * 1000).toLocaleString() : 'Just now';
                const div = document.createElement('div');
                div.className = `log-item ${log.type}`;
                div.innerHTML = `
                    <div>
                        <div style="font-weight:500;">${log.action} <span style="font-weight:normal">- ${log.user} (${log.device || 'N/A'})</span></div>
                        <div style="font-size:0.75rem; color:#94a3b8; margin-top:2px;">${log.desc}</div>
                    </div>
                    <div style="font-size:0.75rem; color:#94a3b8; text-align:right;">${date.split(',')[1]}<br>${date.split(',')[0]}</div>
                `;
                container.appendChild(div);
            });
        };

        // --- UTILS ---
        let currentItem = null;
        window.openModal = function(item) {
            currentItem = item;
            document.getElementById('modalName').innerText = item.name;
            document.getElementById('modalPlatform').innerText = item.platform;
            document.getElementById('modalNum').innerText = item.bankNum;
            document.getElementById('modalNrc').innerText = item.nrc || '-';
            document.getElementById('modalPin').innerText = item.pin || '-';
            document.getElementById('modalAuto').innerText = item.autoNo || '-';
            
            let color = 'bg-other';
            let iconColor = '#334155';
            if(item.platform.includes('KBZ')) { color = 'bg-kpay'; iconColor = '#0056b3'; }
            if(item.platform.includes('Wave')) { color = 'bg-wave'; iconColor = '#fbbf24'; }
            if(item.platform.includes('CB')) { color = 'bg-cb'; iconColor = '#000080'; }
            if(item.platform.includes('UAB')) { color = 'bg-uab'; iconColor = '#000'; }
            if(item.platform.includes('Yoma')) { color = 'bg-yoma'; iconColor = '#dc2626'; }

            document.getElementById('modalHeaderBg').className = 'modal-header ' + color;
            document.getElementById('modalProfile').style.color = iconColor;
            document.getElementById('detailModal').classList.add('active');
            triggerHaptic(20);
        };

        window.editAccount = function() {
            window.closeModal();
            document.getElementById('editId').value = currentItem.id;
            document.getElementById('name').value = currentItem.name;
            document.getElementById('bankNum').value = currentItem.bankNum;
            document.getElementById('nrc').value = currentItem.nrc;
            document.getElementById('pin').value = currentItem.pin;
            document.getElementById('autoNo').value = currentItem.autoNo;
            document.getElementById('platform').value = currentItem.platform;
            
            document.getElementById('formTitle').innerText = "Edit Account";
            document.getElementById('saveBtn').innerText = "Update";
            document.getElementById('cancelBtn').style.display = 'block';
            
            document.querySelectorAll('.chip').forEach(c => {
                c.classList.remove('active');
                if(c.innerText === currentItem.platform) c.classList.add('active');
            });
            window.navTo('createPage');
        };

        window.navTo = function(page, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(page).classList.add('active');
            if(btn) {
                document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
                btn.classList.add('active');
            }
            if(page === 'listPage') window.renderList();
            if(page === 'logPage') window.renderLogs();
            if(document.getElementById('sidebar').classList.contains('active')) window.toggleSidebar();
        };

        window.setPlatform = function(el, val) {
            document.getElementById('platform').value = val;
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            triggerHaptic(10);
        };

        window.updateStats = function() {
            document.getElementById('totalCount').innerText = localAccounts.length;
            const today = new Date().toDateString();
            document.getElementById('todayCount').innerText = localAccounts.filter(i => i.createdAt && new Date(i.createdAt).toDateString() === today).length;
        };

        window.logout = function() {
            if(confirm("Log Out?")) window.location.reload();
        };

        window.toggleSidebar = function() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('overlay').classList.toggle('active');
            triggerHaptic(15);
        };
        window.togglePrivacy = function() {
            document.body.classList.toggle('privacy-active');
            triggerHaptic(20);
        };
        window.toggleHaptic = function() {
            hapticEnabled = !hapticEnabled;
            localStorage.setItem('haptic', hapticEnabled);
            document.getElementById('hapticSwitch').classList.toggle('toggle-active');
            if(hapticEnabled) triggerHaptic(50);
        };
        if(hapticEnabled) document.getElementById('hapticSwitch').classList.add('toggle-active');

        window.closeModal = function() { document.getElementById('detailModal').classList.remove('active'); };
        window.toggleFormPin = function() { const p = document.getElementById('pin'); p.type = p.type==='password'?'text':'password'; };
        window.copyText = function(txt) { if(txt!=='-') { navigator.clipboard.writeText(txt); window.showToast('Copied!', 'success'); triggerHaptic(40); }};
        window.showToast = function(msg, type) {
            const t = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = msg;
            t.className = 'toast show ' + type;
            document.getElementById('toastIcon').className = type==='error'?'fas fa-times-circle':'fas fa-check-circle';
            setTimeout(() => t.classList.remove('show'), 3000);
        };
        window.toggleTheme = function() {
            const b = document.body;
            b.setAttribute('data-theme', b.getAttribute('data-theme')==='dark'?'':'dark');
            triggerHaptic(20);
        };
        window.resetForm = function() {
            document.getElementById('editId').value = '';
            ['name','bankNum','nrc','pin','autoNo'].forEach(id => document.getElementById(id).value = '');
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            document.getElementById('formTitle').innerText = "Create Account";
            document.getElementById('saveBtn').innerText = "Create Account";
            document.getElementById('cancelBtn').style.display = 'none';
        };

        // Connection & Clock
        function updateNet() {
            const i = document.getElementById('wifiIcon');
            i.className = navigator.onLine ? 'fas fa-wifi status-indicator status-online' : 'fas fa-wifi status-indicator status-offline';
        }
        window.addEventListener('online', updateNet); window.addEventListener('offline', updateNet); updateNet();

        setInterval(() => {
            const d = new Date();
            document.getElementById('clock').innerText = d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
            document.getElementById('date').innerText = d.toLocaleDateString([], {weekday:'short', day:'numeric', month:'short'});
        }, 1000);

    </script>
</body>
</html>